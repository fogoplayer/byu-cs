00000000: 2369 6e63 6c75 6465 203c 7374 6469 6f2e  #include <stdio.
00000010: 683e 0a23 696e 636c 7564 6520 3c73 7464  h>.#include <std
00000020: 6c69 622e 683e 0a23 696e 636c 7564 6520  lib.h>.#include 
00000030: 3c73 7472 696e 672e 683e 0a0a 2364 6566  <string.h>..#def
00000040: 696e 6520 5452 5545 2031 0a23 6465 6669  ine TRUE 1.#defi
00000050: 6e65 2046 414c 5345 2030 0a23 6465 6669  ne FALSE 0.#defi
00000060: 6e65 2042 4144 5f4e 554d 4245 525f 4152  ne BAD_NUMBER_AR
00000070: 4753 2031 0a0a 2f2a 2a0a 202a 2050 6172  GS 1../**. * Par
00000080: 7365 7320 7468 6520 636f 6d6d 616e 6420  ses the command 
00000090: 6c69 6e65 2e0a 202a 0a20 2a20 6172 6763  line.. *. * argc
000000a0: 3a20 7468 6520 6e75 6d62 6572 206f 6620  : the number of 
000000b0: 6974 656d 7320 6f6e 2074 6865 2063 6f6d  items on the com
000000c0: 6d61 6e64 206c 696e 6520 2861 6e64 206c  mand line (and l
000000d0: 656e 6774 6820 6f66 2074 6865 0a20 2a20  ength of the. * 
000000e0: 2020 2020 2020 6172 6776 2061 7272 6179        argv array
000000f0: 2920 696e 636c 7564 696e 6720 7468 6520  ) including the 
00000100: 6578 6563 7574 6162 6c65 0a20 2a20 6172  executable. * ar
00000110: 6776 3a20 7468 6520 6172 7261 7920 6f66  gv: the array of
00000120: 2061 7267 756d 656e 7473 2061 7320 7374   arguments as st
00000130: 7269 6e67 7320 2863 6861 722a 2061 7272  rings (char* arr
00000140: 6179 290a 202a 2062 6974 733a 2074 6865  ay). * bits: the
00000150: 2069 6e74 6567 6572 2076 616c 7565 2069   integer value i
00000160: 7320 7365 7420 746f 2054 5255 4520 6966  s set to TRUE if
00000170: 2062 6974 7320 6f75 7470 7574 2069 6e64   bits output ind
00000180: 6963 6174 6564 0a20 2a20 2020 2020 2020  icated. *       
00000190: 6f75 7468 6572 7769 7365 2046 414c 5345  outherwise FALSE
000001a0: 2066 6f72 2068 6578 206f 7574 7075 740a   for hex output.
000001b0: 202a 0a20 2a20 7265 7475 726e 7320 7468   *. * returns th
000001c0: 6520 696e 7075 7420 6669 6c65 2070 6f69  e input file poi
000001d0: 6e74 6572 2028 4649 4c45 2a29 0a20 2a2a  nter (FILE*). **
000001e0: 2f0a 4649 4c45 202a 7061 7273 6543 6f6d  /.FILE *parseCom
000001f0: 6d61 6e64 4c69 6e65 2869 6e74 2061 7267  mandLine(int arg
00000200: 632c 2063 6861 7220 2a2a 6172 6776 2c20  c, char **argv, 
00000210: 696e 7420 2a62 6974 7329 0a7b 0a20 2069  int *bits).{.  i
00000220: 6620 2861 7267 6320 3e20 3229 0a20 207b  f (argc > 2).  {
00000230: 0a20 2020 2070 7269 6e74 6628 2255 7361  .    printf("Usa
00000240: 6765 3a20 2573 205b 2d62 7c2d 6269 7473  ge: %s [-b|-bits
00000250: 5d5c 6e22 2c20 6172 6776 5b30 5d29 3b0a  ]\n", argv[0]);.
00000260: 2020 2020 6578 6974 2842 4144 5f4e 554d      exit(BAD_NUM
00000270: 4245 525f 4152 4753 293b 0a20 207d 0a0a  BER_ARGS);.  }..
00000280: 2020 6966 2028 6172 6763 203d 3d20 3220    if (argc == 2 
00000290: 2626 0a20 2020 2020 2028 7374 7263 6d70  &&.      (strcmp
000002a0: 2861 7267 765b 315d 2c20 222d 6222 2920  (argv[1], "-b") 
000002b0: 3d3d 2030 207c 7c20 7374 7263 6d70 2861  == 0 || strcmp(a
000002c0: 7267 765b 315d 2c20 222d 6269 7473 2229  rgv[1], "-bits")
000002d0: 203d 3d20 3029 290a 2020 7b0a 2020 2020   == 0)).  {.    
000002e0: 2a62 6974 7320 3d20 5452 5545 3b0a 2020  *bits = TRUE;.  
000002f0: 7d0a 2020 656c 7365 0a20 207b 0a20 2020  }.  else.  {.   
00000300: 202a 6269 7473 203d 2046 414c 5345 3b0a   *bits = FALSE;.
00000310: 2020 7d0a 0a20 2072 6574 7572 6e20 7374    }..  return st
00000320: 6469 6e3b 0a7d 0a0a 2f2a 2a0a 202a 2057  din;.}../**. * W
00000330: 7269 7465 7320 6461 7461 2074 6f20 7374  rites data to st
00000340: 646f 7574 2069 6e20 6865 7861 6465 6369  dout in hexadeci
00000350: 6d61 6c2e 0a20 2a0a 202a 2053 6565 206d  mal.. *. * See m
00000360: 7978 7864 2e6d 6420 666f 7220 6465 7461  yxxd.md for deta
00000370: 696c 732e 0a20 2a0a 202a 2064 6174 613a  ils.. *. * data:
00000380: 2061 6e20 6172 7261 7920 6f66 206e 6f20   an array of no 
00000390: 6d6f 7265 2074 6861 6e20 3136 2063 6861  more than 16 cha
000003a0: 7261 6374 6572 730a 202a 2073 697a 653a  racters. * size:
000003b0: 2074 6865 2073 697a 6520 6f66 2074 6865   the size of the
000003c0: 2061 7272 6179 0a20 2a2a 2f0a 766f 6964   array. **/.void
000003d0: 2070 7269 6e74 4461 7461 4173 4865 7828   printDataAsHex(
000003e0: 756e 7369 676e 6564 2063 6861 7220 2a64  unsigned char *d
000003f0: 6174 612c 2073 697a 655f 7420 7369 7a65  ata, size_t size
00000400: 290a 7b0a 2020 666f 7228 696e 7420 6920  ).{.  for(int i 
00000410: 3d20 303b 2069 203c 2031 363b 2069 2b2b  = 0; i < 16; i++
00000420: 290a 2020 7b0a 2020 2020 7072 696e 7466  ).  {.    printf
00000430: 2822 2578 222c 2064 6174 615b 695d 293b  ("%x", data[i]);
00000440: 0a20 2020 2069 6628 6920 2520 3220 3d3d  .    if(i % 2 ==
00000450: 2031 2920 7b0a 2020 2020 2020 7072 696e   1) {.      prin
00000460: 7466 2822 2022 293b 0a20 2020 207d 0a20  tf(" ");.    }. 
00000470: 207d 0a7d 0a0a 2f2a 2a0a 202a 2057 7269   }.}../**. * Wri
00000480: 7465 7320 6461 7461 2074 6f20 7374 646f  tes data to stdo
00000490: 7574 2061 7320 6368 6172 6163 7465 7273  ut as characters
000004a0: 2e0a 202a 0a20 2a20 5365 6520 6d79 7878  .. *. * See myxx
000004b0: 642e 6d64 2066 6f72 2064 6574 6169 6c73  d.md for details
000004c0: 2e0a 202a 0a20 2a20 6461 7461 3a20 616e  .. *. * data: an
000004d0: 2061 7272 6179 206f 6620 6e6f 206d 6f72   array of no mor
000004e0: 6520 7468 616e 2031 3620 6368 6172 6163  e than 16 charac
000004f0: 7465 7273 0a20 2a20 7369 7a65 3a20 7468  ters. * size: th
00000500: 6520 7369 7a65 206f 6620 7468 6520 6172  e size of the ar
00000510: 7261 790a 202a 2a2f 0a76 6f69 6420 7072  ray. **/.void pr
00000520: 696e 7444 6174 6141 7343 6861 7273 2875  intDataAsChars(u
00000530: 6e73 6967 6e65 6420 6368 6172 202a 6461  nsigned char *da
00000540: 7461 2c20 7369 7a65 5f74 2073 697a 6529  ta, size_t size)
00000550: 0a7b 0a20 2070 7269 6e74 6628 2225 7322  .{.  printf("%s"
00000560: 2c20 6461 7461 293b 0a7d 0a0a 766f 6964  , data);.}..void
00000570: 2072 6561 6441 6e64 5072 696e 7449 6e70   readAndPrintInp
00000580: 7574 4173 4865 7828 4649 4c45 202a 696e  utAsHex(FILE *in
00000590: 7075 7429 0a7b 0a20 2075 6e73 6967 6e65  put).{.  unsigne
000005a0: 6420 6368 6172 2064 6174 615b 3136 5d3b  d char data[16];
000005b0: 0a20 2069 6e74 206e 756d 4279 7465 7352  .  int numBytesR
000005c0: 6561 6420 3d20 6672 6561 6428 6461 7461  ead = fread(data
000005d0: 2c20 312c 2031 362c 2069 6e70 7574 293b  , 1, 16, input);
000005e0: 0a20 2075 6e73 6967 6e65 6420 696e 7420  .  unsigned int 
000005f0: 6f66 6673 6574 203d 2030 3b0a 2020 7768  offset = 0;.  wh
00000600: 696c 6520 286e 756d 4279 7465 7352 6561  ile (numBytesRea
00000610: 6420 213d 2030 290a 2020 7b0a 2020 2020  d != 0).  {.    
00000620: 7072 696e 7466 2822 2530 3878 3a22 2c20  printf("%08x:", 
00000630: 6f66 6673 6574 293b 0a20 2020 206f 6666  offset);.    off
00000640: 7365 7420 2b3d 206e 756d 4279 7465 7352  set += numBytesR
00000650: 6561 643b 0a20 2020 2070 7269 6e74 4461  ead;.    printDa
00000660: 7461 4173 4865 7828 6461 7461 2c20 6e75  taAsHex(data, nu
00000670: 6d42 7974 6573 5265 6164 293b 0a20 2020  mBytesRead);.   
00000680: 2070 7269 6e74 6628 2220 2022 293b 0a20   printf("  ");. 
00000690: 2020 2070 7269 6e74 4461 7461 4173 4368     printDataAsCh
000006a0: 6172 7328 6461 7461 2c20 6e75 6d42 7974  ars(data, numByt
000006b0: 6573 5265 6164 293b 0a20 2020 2070 7269  esRead);.    pri
000006c0: 6e74 6628 225c 6e22 293b 0a20 2020 206e  ntf("\n");.    n
000006d0: 756d 4279 7465 7352 6561 6420 3d20 6672  umBytesRead = fr
000006e0: 6561 6428 6461 7461 2c20 312c 2031 362c  ead(data, 1, 16,
000006f0: 2069 6e70 7574 293b 0a20 207d 0a7d 0a0a   input);.  }.}..
00000700: 2f2a 2a0a 202a 2042 6974 7320 6f75 7470  /**. * Bits outp
00000710: 7574 2066 6f72 2078 7864 2e0a 202a 0a20  ut for xxd.. *. 
00000720: 2a20 5365 6520 6d79 7878 642e 6d64 2066  * See myxxd.md f
00000730: 6f72 2064 6574 6169 6c73 2e0a 202a 0a20  or details.. *. 
00000740: 2a20 696e 7075 743a 2069 6e70 7574 2073  * input: input s
00000750: 7472 6561 6d0a 202a 2a2f 0a76 6f69 6420  tream. **/.void 
00000760: 7265 6164 416e 6450 7269 6e74 496e 7075  readAndPrintInpu
00000770: 7441 7342 6974 7328 4649 4c45 202a 696e  tAsBits(FILE *in
00000780: 7075 7429 0a7b 0a20 2070 7269 6e74 6628  put).{.  printf(
00000790: 2254 4f44 4f20 333a 2072 6561 6441 6e64  "TODO 3: readAnd
000007a0: 5072 696e 7449 6e70 7574 4173 4269 7473  PrintInputAsBits
000007b0: 5c6e 2229 3b0a 7d0a 0a69 6e74 206d 6169  \n");.}..int mai
000007c0: 6e28 696e 7420 6172 6763 2c20 6368 6172  n(int argc, char
000007d0: 202a 2a61 7267 7629 0a7b 0a20 2069 6e74   **argv).{.  int
000007e0: 2062 6974 7320 3d20 4641 4c53 453b 0a20   bits = FALSE;. 
000007f0: 2046 494c 4520 2a69 6e70 7574 203d 2070   FILE *input = p
00000800: 6172 7365 436f 6d6d 616e 644c 696e 6528  arseCommandLine(
00000810: 6172 6763 2c20 6172 6776 2c20 2662 6974  argc, argv, &bit
00000820: 7329 3b0a 0a20 2069 6620 2862 6974 7320  s);..  if (bits 
00000830: 3d3d 2046 414c 5345 290a 2020 7b0a 2020  == FALSE).  {.  
00000840: 2020 7265 6164 416e 6450 7269 6e74 496e    readAndPrintIn
00000850: 7075 7441 7348 6578 2869 6e70 7574 293b  putAsHex(input);
00000860: 0a20 207d 0a20 2065 6c73 650a 2020 7b0a  .  }.  else.  {.
00000870: 2020 2020 7265 6164 416e 6450 7269 6e74      readAndPrint
00000880: 496e 7075 7441 7342 6974 7328 696e 7075  InputAsBits(inpu
00000890: 7429 3b0a 2020 7d0a 2020 7265 7475 726e  t);.  }.  return
000008a0: 2030 3b0a 7d0a                            0;.}.
